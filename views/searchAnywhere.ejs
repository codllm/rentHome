<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Stays in <%= location %> ¬∑ stayNest</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .no-scrollbar::-webkit-scrollbar { display: none; }
    .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    .aspect-airbnb { aspect-ratio: 20 / 19; }
  </style>
</head>
<body class="bg-white antialiased text-[#222222]">

  <%- include('partials/navbar') %>

  <header class="border-b border-gray-100 bg-white sticky top-20 z-40">
    <div class="max-w-[1600px] mx-auto px-6 md:px-10 lg:px-20 py-6">
        <h1 class="text-2xl md:text-3xl font-bold tracking-tight">
            <% if (homes.length > 0) { %>
                Stays in <%= location %>
                <span class="text-gray-500 font-normal text-lg ml-2">(<%= homes.length %> homes found)</span>
            <% } else { %>
                No stays found in "<%= location %>"
            <% } %>
        </h1>
        
        <div class="flex gap-3 mt-4 overflow-x-auto no-scrollbar">
            <button class="px-4 py-2 border border-gray-200 rounded-full text-sm font-medium hover:border-black transition">Type of place</button>
            <button class="px-4 py-2 border border-gray-200 rounded-full text-sm font-medium hover:border-black transition">Price</button>
            <button class="px-4 py-2 border border-gray-200 rounded-full text-sm font-medium hover:border-black transition">Instant Book</button>
        </div>
    </div>
  </header>

  <main class="max-w-[1600px] mx-auto px-6 md:px-10 lg:px-20 py-10">

    <% if (homes.length > 0) { %>
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-x-6 gap-y-10">
            
            <% homes.forEach(home => { %>
                <%
                    let images = [];
                    try {
                        images = Array.isArray(home.image_url) ? home.image_url : JSON.parse(home.image_url);
                    } catch (err) { images = [home.image_url]; }
                %>

                <div class="group cursor-pointer">
                    <a href="/homes/<%= home.id %>" class="block">
                        
                        <div class="relative aspect-airbnb rounded-2xl overflow-hidden bg-gray-200 mb-3">
                            <img 
                                src="<%= images[0] %>" 
                                alt="<%= home.title %>"
                                class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500"
                            />
                            
                            <div class="absolute top-3 right-3">
                                <svg viewBox="0 0 32 32" class="w-6 h-6 stroke-white stroke-[2px] fill-black/30 hover:fill-[#FF385C] transition-colors"><path d="M16 28c7-4.73 14-10 14-17a6.98 6.98 0 0 0-7-7c-1.8 0-3.58.68-4.95 2.05L16 8.1l-2.05-2.05a6.98 6.98 0 0 0-9.9 0 6.98 6.98 0 0 0 0 9.9z"></path></svg>
                            </div>

                            <% if (home.booking_status === 'CONFIRMED') { %>
                                <div class="absolute inset-0 bg-white/40 flex items-center justify-center backdrop-blur-[1px]">
                                    <span class="bg-black/80 text-white px-3 py-1 rounded-md text-[10px] font-bold uppercase tracking-widest">Reserved</span>
                                </div>
                            <% } %>
                        </div>

                        <div class="flex flex-col gap-1">
                            <div class="flex justify-between items-center">
                                <h3 class="font-bold text-[15px] truncate"><%= home.location %></h3>
                                <div class="flex items-center gap-1 text-sm">
                                    <span>‚òÖ</span>
                                    <span class="font-light">4.9</span>
                                </div>
                            </div>
                            <p class="text-gray-500 text-[15px] font-light truncate leading-tight"><%= home.title %></p>
                            <p class="text-gray-500 text-[15px] font-light">Available next week</p>
                            <p class="mt-1 text-[15px]">
                                <span class="font-bold">‚Çπ<%= home.price.toLocaleString('en-IN') %></span> 
                                <span class="font-light">night</span>
                            </p>
                        </div>
                    </a>
                </div>
            <% }) %>

        </div>
    <% } else { %>
        <div class="py-20 text-center">
            <div class="text-6xl mb-4">üîç</div>
            <h2 class="text-2xl font-bold">No results found</h2>
            <p class="text-gray-500 mt-2">Try adjusting your search or looking in a different area.</p>
            <a href="/" class="mt-6 inline-block px-6 py-3 bg-[#FF385C] text-white rounded-lg font-bold">Clear search</a>
        </div>
    <% } %>

  </main>

  <%- include('partials/footer') %>

</body>
</html>